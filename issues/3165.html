<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Enhancement #3165: FTP (vsftpd): add UDP port to web interface - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" name="csrf-token" />
<link rel='shortcut icon' href='/favicon.ico?1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057" media="all" rel="stylesheet" type="text/css" />
<link href="../stylesheets/application.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver../javascripts/theme.js%3F1403512057" type="text/javascript"></script>
<link href="/plugin_assets/openid_fix../stylesheets/openid.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/3165.atom" rel="alternate" title="NethServer 6 - Enhancement #3165: FTP (vsftpd): add UDP port to web interface" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="/login" class="login">Sign in</a></li></ul>    </div>
    
    <ul><li><a href="/" class="home">Home</a></li>
<li><a href="/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    <div id="quick-search">
        <form accept-charset="UTF-8" action="/projects/nethserver/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
        <input name="issues" type="hidden" value="1" />
        <label for='q'>
          <a href="/projects/nethserver/search" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
</form>        
    </div>

    <h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>
<li><a href="/projects/nethserver/activity" class="activity">Activity</a></li>
<li><a href="/projects/nethserver/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="/projects/nethserver/issues" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki" class="wiki">Wiki</a></li>
<li><a href="/projects/nethserver/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/nethserver/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/nethserver/issues/report">Summary</a></li>

</ul>




<h3>Custom queries</h3>
<ul class="queries"><li><a href="/projects/nethserver/issues?query_id=60" class="query">6.6 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=64" class="query">6.7 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=65" class="query">6.8 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=66" class="query">6.9 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=12" class="query">@future/closed</a></li>
<li><a href="/projects/nethserver/issues?query_id=55" class="query">KNOWN_BUGS</a></li>
<li><a href="/projects/nethserver/issues?query_id=15" class="query">Lost+Found</a></li>
<li><a href="/projects/nethserver/issues?query_id=24" class="query">NEEDINFO</a></li>
<li><a href="/projects/nethserver/issues?query_id=26" class="query">ON_DEV</a></li>
<li><a href="/projects/nethserver/issues?query_id=27" class="query">ON_QA</a></li>
<li><a href="/projects/nethserver/issues?query_id=44" class="query">TODO Tasks</a></li>
<li><a href="/projects/nethserver/issues?query_id=54" class="query selected">UPDATES</a></li>
<li><a href="/projects/nethserver/issues?query_id=67" class="query">v6.10 (current)</a></li></ul>





        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Enhancement #3165</h2>

<div class="issue tracker-6 status-5 priority-4 priority-default closed details">

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>FTP (vsftpd): add UDP port to web interface</h3></div>
</div>
        <p class="author">
        Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:28 AM">about 6 years</a> ago.
        Updated <a href="/projects/nethserver/activity?from=2016-05-27" title="05/27/2016 12:03 PM">about 5 years</a> ago.
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date">05/14/2015</td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date">05/14/2015</td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-vsftpd</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="/versions/214">v6.7</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_13">Resolution:</th><td class="cf_13">WONTFIX</td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Add the ability to change the TCPPort directly from the web interface.</p>


	<p>See pull request from stephdl: <a class="external" href="https://github.com/nethesis/nethserver-vsftpd/pull/2">https://github.com/nethesis/nethserver-vsftpd/pull/2</a></p>
  </div>
</div>





<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form>
<table class="list issues">
  <tr class="issue hascontextmenu" id="relation-720">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="3164" /></td>
  <td class="subject">
    Copied from
    
    NethServer 6 - 
    <a href="/issues/3164" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #3164</a>: OpenVPN: add UDP port to web interface
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">05/13/2015</td>
  <td class="due_date">05/14/2015</td>
  <td class="buttons"></td>
  </tr>
</table>
</form>

<form accept-charset="UTF-8" action="/issues/3165/relations" class="new_relation" data-remote="true" id="new-relation-form" method="post" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates" selected="selected">Related to</option>
<option value="duplicates">Duplicates</option>
<option value="duplicated">Duplicated by</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script type="text/javascript">
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?project_id=nethserver&scope=all')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-vsftpd/revisions/2983f214a3036fc3718c0295877c0f09c1b33c36" title="Revision 2983f214">Revision 2983f214</a><br />
        <span class="author">Added by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:56 AM">about 6 years</a> ago</span></p>
    <div class="wiki">
        <p>Web UI: add TCP port. Refs <a href="/issues/3165" class="issue tracker-6 status-5 priority-4 priority-default closed" title="FTP (vsftpd): add UDP port to web interface (CLOSED)">#3165</a><br />- Add an input box to change TCPPort in nethgui<br />- Add an expandable field for advanced configuration<br />- Switch to the new mock standard</p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-vsftpd/revisions/2aea0caffb702f78427e85d4bc4730e90af29a16" title="Revision 2aea0caf">Revision 2aea0caf</a><br />
        <span class="author">Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-07-27" title="07/27/2015 09:44 AM">about 6 years</a> ago</span></p>
    <div class="wiki">
        <p>Revert "Web UI: add TCP port. Refs <a href="/issues/3165" class="issue tracker-6 status-5 priority-4 priority-default closed" title="FTP (vsftpd): add UDP port to web interface (CLOSED)">#3165</a>"</p>


	<p>This reverts commit 2983f214a3036fc3718c0295877c0f09c1b33c36.</p>
    </div>
    </div>

</div>

<div id="history">
<h3>History</h3>
  <div id="change-15182" class="journal has-details">
    <div id="note-1">
    <h4><a href="/issues/3165#note-1" class="journal-link">#1</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:28 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Copied from</strong> <i><a href="/issues/3164" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #3164</a>: OpenVPN: add UDP port to web interface</i> added</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-15184" class="journal has-details">
    <div id="note-2">
    <h4><a href="/issues/3165#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:28 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>nethserver-vsftpd</i></li>
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>TRIAGED</i></li>
       <li><strong>Target version</strong> set to <i>v6.6</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>20</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-15186" class="journal has-details">
    <div id="note-3">
    <h4><a href="/issues/3165#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:29 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>Assignee</strong> set to <i>Giacomo Sanchietti</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-15187" class="journal has-details">
    <div id="note-4">
    <h4><a href="/issues/3165#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:39 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-15188" class="journal has-notes has-details">
    <div id="note-5">
    <h4><a href="/issues/3165#note-5" class="journal-link">#5</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-13" title="05/13/2015 05:49 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Giacomo Sanchietti</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-15188-notes">Package in nethserver-testing:
	<ul>
	<li>nethserver-vsftpd-1.0.1-1.2.g6eac85e.ns6.noarch.rpm</li>
	</ul>


<strong>Test case</strong>
	<ul>
	<li>Change the port from the web interface</li>
		<li>Check the daemon listen to new port</li>
		<li>Check the service is accessible through the firewall</li>
	</ul></div>
    </div>
  </div>
  
  <div id="change-15243" class="journal has-details">
    <div id="note-6">
    <h4><a href="/issues/3165#note-6" class="journal-link">#6</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ee549982798e3db27940dc43b391c43a?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/325" class="user active">Vasco Castelo Branco</a> <a href="/projects/nethserver/activity?from=2015-05-14" title="05/14/2015 08:27 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Vasco Castelo Branco</i></li>
       <li><strong>Start date</strong> set to <i>05/14/2015</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-15254" class="journal has-notes has-details">
    <div id="note-7">
    <h4><a href="/issues/3165#note-7" class="journal-link">#7</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ee549982798e3db27940dc43b391c43a?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/325" class="user active">Vasco Castelo Branco</a> <a href="/projects/nethserver/activity?from=2015-05-14" title="05/14/2015 03:50 PM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Due date</strong> set to <i>05/14/2015</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Vasco Castelo Branco</i></del>)</li>
       <li><strong>Resolution</strong> set to <i>REJECTED</i></li>
    </ul>
    <div class="wiki" id="journal-15254-notes"><p>Change the port from the web interface                          OK<br />Check the daemon listen to new port                              OK<br />Check the service is accessible through the firewall   OK</p>


	<p>The tree tests was OK but is only possible connect to ftp at port 21<br />If the port is changed in the web interface the deamon is listing in the new port and is accessible trough the firewall but I always have the error:  ECONNREFUSED - Connection refused by server</p>


	<p>The FTP server only accept connections at port 21</p></div>
    </div>
  </div>
  
  <div id="change-15255" class="journal has-notes has-details">
    <div id="note-8">
    <h4><a href="/issues/3165#note-8" class="journal-link">#8</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-15" title="05/15/2015 04:02 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>TRIAGED</i></li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>20</i></li>
       <li><strong>Resolution</strong> deleted (<del><i>REJECTED</i></del>)</li>
    </ul>
    <div class="wiki" id="journal-15255-notes"><p>The problem comes from the passive mode which uses ip_conntrack_ftp to dynamically open the firewall ports.</p>


This is how it works (source: <a class="external" href="http://serverfault.com/questions/421161/how-to-configure-vsftpd-to-work-with-passive-mode">http://serverfault.com/questions/421161/how-to-configure-vsftpd-to-work-with-passive-mode</a>):
	<ul>
	<li>Your client makes a connection to the vsftpd server on port 21.</li>
		<li>The sever responds to the client telling it which port to connect to from the range specified above.</li>
		<li>The client makes a data connection on the specified port and the session continues.</li>
	</ul>


	<p>But ip_conntrack_ftp works only on port 21, unless an option is passed to kernel module when at load time.</p>


	<p>To make the port change working, the package should also unload and reload the module with the correct option (<code>options nf_conntrack_ftp ports=21,3000</code>).<br />Another possible solution is to open all ports between <code>pasv_min_port</code> and <code>pasv_max_port</code>, but I don't really like it.</p></div>
    </div>
  </div>
  
  <div id="change-15266" class="journal has-notes">
    <div id="note-9">
    <h4><a href="/issues/3165#note-9" class="journal-link">#9</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-15" title="05/15/2015 11:00 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15266-notes"><p>Well I suppose that my code is not in fault for this bug, maybe another bug should be opened concerning the change of port for vsftpd ????</p></div>
    </div>
  </div>
  
  <div id="change-15278" class="journal has-notes">
    <div id="note-10">
    <h4><a href="/issues/3165#note-10" class="journal-link">#10</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-18" title="05/18/2015 02:48 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15278-notes"><p>stephane de Labrusse wrote:</p>


<blockquote>

	<p>Well I suppose that my code is not in fault for this bug, maybe another bug should be opened concerning the change of port for vsftpd ????</p>


</blockquote>

	<p>Surely is not a bug in you code, but any modification to the web interface should work seamlessly with the underlying system.<br />If we still want to change the ftp server port, I'd like to make the needed modification using this bug.</p></div>
    </div>
  </div>
  
  <div id="change-15321" class="journal has-notes has-details">
    <div id="note-11">
    <h4><a href="/issues/3165#note-11" class="journal-link">#11</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-18" title="05/18/2015 03:13 PM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>stephane de Labrusse</i></li>
    </ul>
    <div class="wiki" id="journal-15321-notes"><p>I would have a go on this bug</p></div>
    </div>
  </div>
  
  <div id="change-15324" class="journal has-notes">
    <div id="note-12">
    <h4><a href="/issues/3165#note-12" class="journal-link">#12</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 02:45 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15324-notes"><p>stephane de Labrusse wrote:</p>


<blockquote>

	<p>I would have a go on this bug</p>


</blockquote>

	<p>Go! :)</p>


	<p>Maybe the simplest implementation is to reload the conntrack module with the changed port.</p></div>
    </div>
  </div>
  
  <div id="change-15345" class="journal has-notes">
    <div id="note-13">
    <h4><a href="/issues/3165#note-13" class="journal-link">#13</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 03:46 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15345-notes"><p>well I did many attempts yesterday night, sometime it doesn't come out of the box :( probably because I never look inside the firewal adjustment of neth, it was a good opportunity to learn some stuffs</p>


	<p>The workable solution I found is to add (custom port is 6000)</p>


<pre>
[root@nethserver-dev ~]# cat /etc/modprobe.d/conntrack.conf
 options ip_conntrack_ftp ports=21,6000
</pre><br />and reload with<br /><pre>
signal-event firewall-adjust
</pre>

	<p>but what about with shorewall  ????</p>


	<p>side note :  we should add in the documentation that the port should be superior than 1024 and inferior to 65xxx if you want to get custom port (maybe custom validator : X==21 || 1024 >= X <= 65xxx)</p>


	<p>thoughts before i write the template :)</p></div>
    </div>
  </div>
  
  <div id="change-15384" class="journal has-notes">
    <div id="note-14">
    <h4><a href="/issues/3165#note-14" class="journal-link">#14</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 10:40 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15384-notes"><blockquote>

	<p>but what about with shorewall  ????</p>


</blockquote>

	<p>It's quite complex, see <a class="external" href="http://shorewall.net/FTP.html">http://shorewall.net/FTP.html</a><br />Otherwise we can open a list of ports, but then you must enforce these ones...maybe the all thing of custom port is not a really good idea?</p></div>
    </div>
  </div>
  
  <div id="change-15394" class="journal has-notes">
    <div id="note-15">
    <h4><a href="/issues/3165#note-15" class="journal-link">#15</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 12:51 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15394-notes"><p>well I must admit the firewall is not my area of expertise but I tried to install nethserver-firewall and I have no problem to reach the ftp server on the port 6000...of course I haven't done nothing more than in the post above.</p>


	<p>Do it is normal ... if i add a nic as red can I have issues ?</p></div>
    </div>
  </div>
  
  <div id="change-15396" class="journal has-notes">
    <div id="note-16">
    <h4><a href="/issues/3165#note-16" class="journal-link">#16</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 01:08 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15396-notes"><p>I tried two configurations of tests</p>


	<p>eth0->green<br />no problem at all you can connect to shorewall or to iptables without more settings on the port 6000</p>


	<p>eth0->red<br />you can NOT  connect to shorewall exepted if manually in Nethgui you create a firewall rule concerning the vsftpd service for the relevant port (6000 here)</p>


	<p>In brief it seems to works for me, the manual rules creation seems normal for me....do i'm wrong, where I can fail ?</p></div>
    </div>
  </div>
  
  <div id="change-15397" class="journal has-notes">
    <div id="note-17">
    <h4><a href="/issues/3165#note-17" class="journal-link">#17</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 03:48 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15397-notes"><p>I must add that I forgot to verify the status access of vsftpd, it was set to private</p>


	<p>after <br /><pre>
config setprop vsftpd access public
signal-event firewall-adjust
</pre></p>


	<p>Now I can connect to shorewall without custom rules</p>


	<p>when I do</p>


	<p>[root@nethserver-dev ~]# db fwrules show<br />I have no rules :)</p>


	<p>therefore, of course I can be wrong but for me, we just need to add for iptables (6000 = custom port)<br /><pre>
[root@nethserver-dev ~]# cat /etc/modprobe.d/conntrack.conf 
options ip_conntrack_ftp ports=21,6000
</pre></p>


	<p>it seems that at least for vsftpd, it is workable with shorewall.</p>


<pre>
lsd@leonardcohen:~$ ftp -p 192.168.12.193 6000
Connected to 192.168.12.193 (192.168.12.193).
220 (vsFTPd 2.2.2)
Name (192.168.12.193:lsd): stephane
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
227 Entering Passive Mode (192,168,12,193,119,3).
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 May 19 07:00 plop
drwxr-xr-x    2 ftp      ftp          4096 May 19 07:01 plopi
226 Directory send OK.
</pre>

	<p>Thoughts ?</p></div>
    </div>
  </div>
  
  <div id="change-15398" class="journal has-notes">
    <div id="note-18">
    <h4><a href="/issues/3165#note-18" class="journal-link">#18</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 03:52 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15398-notes"><p>Giacomo Sanchietti wrote:</p>


<blockquote>

	<p>Otherwise we can open a list of ports, but then you must enforce these ones...maybe the all thing of custom port is not a really good idea?</p>


</blockquote>

	<p>Well in My really humble opinion (I have no lessons to give, just lessons to learn) each service should be able to work on custom ports...if I want a nginx with apache, a really secured ftp,.....and i could find a lot of more examples</p></div>
    </div>
  </div>
  
  <div id="change-15399" class="journal has-notes">
    <div id="note-19">
    <h4><a href="/issues/3165#note-19" class="journal-link">#19</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2015-05-19" title="05/19/2015 04:57 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15399-notes"><p>227 Entering Passive Mode (192,168,12,193,119,3).</p>


	<p>Could you please try active mode? It should work out of the box, but I'd prefer to have it verified.Thank you.</p></div>
    </div>
  </div>
  
  <div id="change-15437" class="journal has-notes">
    <div id="note-20">
    <h4><a href="/issues/3165#note-20" class="journal-link">#20</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-05-20" title="05/20/2015 01:11 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15437-notes"><p>Filippo Carletti wrote:</p>


<blockquote>

	<p>227 Entering Passive Mode (192,168,12,193,119,3).</p>


	<p>Could you please try active mode? It should work out of the box, but I'd prefer to have it verified.Thank you.</p>


</blockquote>

	<p>yep tested without problems : add 'pasv_enable=NO' to /etc/e-smith/templates/etc/vsftpd/vsftpd.conf/80listen<br /><pre>
listen=YES 
listen_port={$vsftpd{TCPPort} || '21'}
pasv_min_port=30000
pasv_max_port=30999
+ pasv_enable=NO
</pre></p>


	<p>after that you are in active mode (forced) but beware that in active mode your ftp client need to allow port > 1023 in its firewall, it is the difference with the passive mode, in this former mode, the server opens hight ports</p>


	<p>If you fail to test it, please deactivate the firewall of the client side</p>


	<p>see <a class="external" href="http://zaman4linux.blogspot.fr/2009/10/configuring-ftp-server-using-vsftpd.html">http://zaman4linux.blogspot.fr/2009/10/configuring-ftp-server-using-vsftpd.html</a> for details and troubleshooting.</p>


	<p>pull request done in Github</p></div>
    </div>
  </div>
  
  <div id="change-15442" class="journal has-notes">
    <div id="note-21">
    <h4><a href="/issues/3165#note-21" class="journal-link">#21</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-05-21" title="05/21/2015 04:51 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15442-notes"><p>Current implementation works correctly with lokkit both in passive and active mode (which can be selected from the client side).</p>


	<p>But, if Shorewall is installed (nethserver-firewall-base package), the kernel modules is not reloaded with the changed port.<br />You can check current loaded parameters with:<br /><pre>
cat /sys/module/nf_conntrack_ftp/parameters/ports
</pre></p>


	<p>We have plans to remove lokkit in the near future, so we should find a viable way for Shorewall implementation.</p>


	<p>Current implementation is not optimal but we can merge the pull request and add a note to the manual:<br /><pre>
  If Shorewall (nethserver-firewall-base package) is installed, 
  access the FTP server using active mode if configured port is not the default one (21).
</pre></p></div>
    </div>
  </div>
  
  <div id="change-15443" class="journal has-notes">
    <div id="note-22">
    <h4><a href="/issues/3165#note-22" class="journal-link">#22</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2015-05-21" title="05/21/2015 05:06 AM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15443-notes"><p>Since we're going to remove lokkit, I'd prefer to defer implementation: we will produce better and simpler code. Also, we're going to merge code we're going to remove soon. <br />What do you think? Active mode works on every port.</p></div>
    </div>
  </div>
  
  <div id="change-15471" class="journal has-notes">
    <div id="note-23">
    <h4><a href="/issues/3165#note-23" class="journal-link">#23</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/1be3cefe3c0e087f283fd7702b8f7c76?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/179" class="user active">stephane de Labrusse</a> <a href="/projects/nethserver/activity?from=2015-06-03" title="06/03/2015 04:01 PM">about 6 years</a> ago</h4>

    <div class="wiki" id="journal-15471-notes"><p>Filippo Carletti wrote:</p>


<blockquote>

	<p>Since we're going to remove lokkit, I'd prefer to defer implementation: we will produce better and simpler code. Also, we're going to merge code we're going to remove soon. <br />What do you think? Active mode works on every port.</p>


</blockquote>

	<p>Like giacomo noticed it, the module nf_conntrack_ftp is updated at each reboot, but I failed to update it on demand....I don't know if you can bring some guidances. As an evidence my code can not be added if it is not fully workable but that let's  something broken under the hood because you can't change the default port, even by the command line. That's a bug.</p>


	<p>???</p></div>
    </div>
  </div>
  
  <div id="change-15977" class="journal has-notes has-details">
    <div id="note-24">
    <h4><a href="/issues/3165#note-24" class="journal-link">#24</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2015-07-27" title="07/27/2015 09:49 AM">about 6 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>NEW</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>stephane de Labrusse</i></del>)</li>
       <li><strong>Target version</strong> deleted (<del><i>v6.6</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>0</i></li>
    </ul>
    <div class="wiki" id="journal-15977-notes"><p>Since the implementation is not complete due to nf_conntrack_ftp configuration, the commit has been reverted.</p>


	<p>There is no developer for this enhancement: the issue has been moved to NEW status and postponed.</p></div>
    </div>
  </div>
  
  <div id="change-17387" class="journal has-notes has-details">
    <div id="note-25">
    <h4><a href="/issues/3165#note-25" class="journal-link">#25</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2016-05-27" title="05/27/2016 12:02 PM">about 5 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Resolution</strong> set to <i>WONTFIX</i></li>
    </ul>
    <div class="wiki" id="journal-17387-notes"><p>Leaving behind on NS 6.<br />Let's see for NS 7.</p>


	<p>If needed open a bug on <a class="external" href="https://github.com/NethServer/dev/issues">https://github.com/NethServer/dev/issues</a></p></div>
    </div>
  </div>
  
  <div id="change-17388" class="journal has-details">
    <div id="note-26">
    <h4><a href="/issues/3165#note-26" class="journal-link">#26</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2016-05-27" title="05/27/2016 12:03 PM">about 5 years</a> ago</h4>

    <ul class="details">
       <li><strong>Target version</strong> set to <i>v6.7</i></li>
    </ul>
    
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>

<p class="other-formats">Also available in:  <span><a href="/issues/3165.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="/issues/3165.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>



<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright © 2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
