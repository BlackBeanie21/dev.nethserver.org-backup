<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Enhancement #3434: Upgrade from default version of Squid for SHA2 certificates - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" name="csrf-token" />
<link rel='shortcut icon' href='/favicon.ico?1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057" media="all" rel="stylesheet" type="text/css" />
<link href="../stylesheets/application.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver../javascripts/theme.js%3F1403512057" type="text/javascript"></script>
<link href="/plugin_assets/openid_fix../stylesheets/openid.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/3434.atom" rel="alternate" title="NethServer 6 - Enhancement #3434: Upgrade from default version of Squid for SHA2 certificates" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="/login" class="login">Sign in</a></li></ul>    </div>
    
    <ul><li><a href="/" class="home">Home</a></li>
<li><a href="/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    <div id="quick-search">
        <form accept-charset="UTF-8" action="/projects/nethserver/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
        <input name="issues" type="hidden" value="1" />
        <label for='q'>
          <a href="/projects/nethserver/search" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
</form>        
    </div>

    <h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>
<li><a href="/projects/nethserver/activity" class="activity">Activity</a></li>
<li><a href="/projects/nethserver/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="/projects/nethserver/issues" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki" class="wiki">Wiki</a></li>
<li><a href="/projects/nethserver/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/nethserver/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/nethserver/issues/report">Summary</a></li>

</ul>




<h3>Custom queries</h3>
<ul class="queries"><li><a href="/projects/nethserver/issues?query_id=60" class="query">6.6 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=64" class="query">6.7 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=65" class="query">6.8 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=66" class="query">6.9 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=12" class="query">@future/closed</a></li>
<li><a href="/projects/nethserver/issues?query_id=55" class="query">KNOWN_BUGS</a></li>
<li><a href="/projects/nethserver/issues?query_id=15" class="query">Lost+Found</a></li>
<li><a href="/projects/nethserver/issues?query_id=24" class="query">NEEDINFO</a></li>
<li><a href="/projects/nethserver/issues?query_id=26" class="query">ON_DEV</a></li>
<li><a href="/projects/nethserver/issues?query_id=27" class="query">ON_QA</a></li>
<li><a href="/projects/nethserver/issues?query_id=44" class="query">TODO Tasks</a></li>
<li><a href="/projects/nethserver/issues?query_id=54" class="query selected">UPDATES</a></li>
<li><a href="/projects/nethserver/issues?query_id=67" class="query">v6.10 (current)</a></li></ul>





        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Enhancement #3434</h2>

<div class="issue tracker-6 status-5 priority-4 priority-default closed details">

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/7b79c2a46165d3dbd70227b3736bd4ae?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>Upgrade from default version of Squid for SHA2 certificates</h3></div>
</div>
        <p class="author">
        Added by <a href="/users/390" class="user active">Jacob Oliver</a> <a href="/projects/nethserver/activity?from=2016-12-01" title="12/01/2016 06:54 AM">over 4 years</a> ago.
        Updated <a href="/projects/nethserver/activity?from=2016-12-13" title="12/13/2016 09:14 AM">over 4 years</a> ago.
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date"></td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date"></td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-squid</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="/versions/219">v6.8</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_13">Resolution:</th><td class="cf_13">NEXTRELEASE</td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Not 100% sure where to log this but it is a high priority as it not only produces security issues for anyone using SSL web filtering but will also cause NethServer to break clients with web filtering over the next few months.</p>


	<p>Currently NethServer is running squid that is shipped with CentOS - CentOS 7 only provides Squid 3.3.8 and it only generates certificates using SHA-1 algorithms which are now classed as a security risk. Browsers such as Google Chrome will be removing support for SHA-1 certificates in January 2017 which means all devices making use of the web filtering will start to be restricted as to the content that they can access.</p>


	<p>I have tested an install of Squid 3.5.22 which supports SHA-2 certificates and can confirm that so far it has worked throughout some limited testing. I am not yet sure whether an upgrade works but I don't see any reason why it wouldn't work.</p>


	<p>The steps to upgrade are as following:<br />Modify /etc/yum.repos.d/CentOS-Base.repo and add "exclude=squid*" to the bottom of the [base] repo section</p>


	<p>Create /etc/yum.repos.d/squid.repo with the following contents:<br />[squid]<br />name=Squid repo for CentOS<br />baseurl=http://www1.ngtech.co.il/repo/centos/$releasever/$basearch/<br />failovermethod=priority<br />enabled=1<br />gpgcheck=0</p>


	<p>Then install/upgrade squid and all of it's respective libraries. It may be worth removing all old versions before installing.<br />The packaged needed to be installed are:<br />squid<br />squid-helpers (Used to provide ssl_crtd and other useful binaries)</p>


	<p>Then run:<br />/usr/lib64/squid/ssl_crtd -c -s /var/lib/ssl_db</p>


	<p>After this, start/restart squid and it will be up and running again but this time with SHA2 support.</p>
  </div>
</div>






</div>


<div id="history">
<h3>History</h3>
  <div id="change-17748" class="journal has-notes">
    <div id="note-1">
    <h4><a href="/issues/3434#note-1" class="journal-link">#1</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/7b79c2a46165d3dbd70227b3736bd4ae?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/390" class="user active">Jacob Oliver</a> <a href="/projects/nethserver/activity?from=2016-12-01" title="12/01/2016 10:25 AM">over 4 years</a> ago</h4>

    <div class="wiki" id="journal-17748-notes"><p>See <a class="external" href="https://github.com/NethServer/nethserver-squid/pull/10">https://github.com/NethServer/nethserver-squid/pull/10</a> for the initial commit for the ssl_db work.<br />Now need to add the repos and exclude squid from one.</p></div>
    </div>
  </div>
  
  <div id="change-17749" class="journal has-notes">
    <div id="note-2">
    <h4><a href="/issues/3434#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2016-12-02" title="12/02/2016 05:06 AM">over 4 years</a> ago</h4>

    <div class="wiki" id="journal-17749-notes"><p>Jacob Oliver wrote:</p>


<blockquote>

	<p>Not 100% sure where to log this but it is a high priority as it not only produces security issues for anyone using SSL web filtering but will also cause NethServer to break clients with web filtering over the next few months.</p>


</blockquote>

	<p>Thank you for bringing this to attention.<br />I've recently proposed to drop the MITM squid ssl bump feature and stop generating SSL certificates, did you follow the discussion?<br /><a class="external" href="http://community.nethserver.org/t/transparent-https-proxy/5064">http://community.nethserver.org/t/transparent-https-proxy/5064</a></p>


<blockquote>

	<p>I have tested an install of Squid 3.5.22 which supports SHA-2 certificates and can confirm that so far it has worked throughout some limited testing. I am not yet sure whether an upgrade works but I don't see any reason why it wouldn't work.</p>


</blockquote>

	<p>I've used Eliezer's squid package for my tests and I know it can't be an upgrade (but I have a patch). Meanwhile, Red Hat released 7.3, which brings squid 3.5.20, you'll find more details in the forum link above.</p>


	<p>If you don't mind, I'll try to merge your github pull request after my pull request for the new transparent proxy is merged.<br />Let's move the discussion on github:<br /><a class="external" href="https://github.com/NethServer/dev/issues/5169">https://github.com/NethServer/dev/issues/5169</a></p></div>
    </div>
  </div>
  
  <div id="change-17752" class="journal has-details">
    <div id="note-3">
    <h4><a href="/issues/3434#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2016-12-05" title="12/05/2016 04:28 AM">over 4 years</a> ago</h4>

    <ul class="details">
       <li><strong>Priority</strong> changed from <i>High</i> to <i>Normal</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-17769" class="journal has-notes has-details">
    <div id="note-4">
    <h4><a href="/issues/3434#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2016-12-13" title="12/13/2016 09:14 AM">over 4 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Resolution</strong> set to <i>NEXTRELEASE</i></li>
    </ul>
    <div class="wiki" id="journal-17769-notes"><p>Jacob, the issue is fixed on NethServer 7, I'm closing this.</p></div>
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>

<p class="other-formats">Also available in:  <span><a href="/issues/3434.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="/issues/3434.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>



<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright © 2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
