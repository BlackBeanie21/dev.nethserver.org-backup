<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Feature #1910: Help DMARC setup - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" name="csrf-token" />
<link rel='shortcut icon' href='/favicon.ico?1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057" media="all" rel="stylesheet" type="text/css" />
<link href="../stylesheets/application.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver../javascripts/theme.js%3F1403512057" type="text/javascript"></script>
<link href="/plugin_assets/openid_fix../stylesheets/openid.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/1910.atom" rel="alternate" title="NethServer 6 - Feature #1910: Help DMARC setup" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="/login" class="login">Sign in</a></li></ul>    </div>
    
    <ul><li><a href="/" class="home">Home</a></li>
<li><a href="/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    <div id="quick-search">
        <form accept-charset="UTF-8" action="/projects/nethserver/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
        <input name="issues" type="hidden" value="1" />
        <label for='q'>
          <a href="/projects/nethserver/search" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
</form>        
    </div>

    <h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>
<li><a href="/projects/nethserver/activity" class="activity">Activity</a></li>
<li><a href="/projects/nethserver/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="/projects/nethserver/issues" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki" class="wiki">Wiki</a></li>
<li><a href="/projects/nethserver/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/nethserver/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/nethserver/issues/report">Summary</a></li>

</ul>




<h3>Custom queries</h3>
<ul class="queries"><li><a href="/projects/nethserver/issues?query_id=60" class="query">6.6 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=64" class="query">6.7 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=65" class="query">6.8 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=66" class="query">6.9 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=12" class="query">@future/closed</a></li>
<li><a href="/projects/nethserver/issues?query_id=55" class="query">KNOWN_BUGS</a></li>
<li><a href="/projects/nethserver/issues?query_id=15" class="query">Lost+Found</a></li>
<li><a href="/projects/nethserver/issues?query_id=24" class="query">NEEDINFO</a></li>
<li><a href="/projects/nethserver/issues?query_id=26" class="query">ON_DEV</a></li>
<li><a href="/projects/nethserver/issues?query_id=27" class="query">ON_QA</a></li>
<li><a href="/projects/nethserver/issues?query_id=44" class="query">TODO Tasks</a></li>
<li><a href="/projects/nethserver/issues?query_id=54" class="query selected">UPDATES</a></li>
<li><a href="/projects/nethserver/issues?query_id=67" class="query">v6.10 (current)</a></li></ul>





        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #1910</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>Help DMARC setup</h3></div>
</div>
        <p class="author">
        Added by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2013-05-02" title="05/02/2013 05:40 PM">over 8 years</a> ago.
        Updated <a href="/projects/nethserver/activity?from=2016-08-26" title="08/26/2016 08:48 AM">almost 5 years</a> ago.
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date"></td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date"></td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-mail-server</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="/versions/113">~FUTURE</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_13">Resolution:</th><td class="cf_13">REJECTED</td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>See <a class="external" href="http://www.dmarc.org/">http://www.dmarc.org/</a> for background.<br />The idea is to help the sysadmin to setup DMARC, SPF and DKIM, showing DNS records on a server-manager page.</p>
  </div>
</div>






</div>


<div id="history">
<h3>History</h3>
  <div id="change-5883" class="journal has-notes">
    <div id="note-2">
    <h4><a href="/issues/1910#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2013-05-09" title="05/09/2013 12:24 PM">about 8 years</a> ago</h4>

    <div class="wiki" id="journal-5883-notes"><p>This feature could be implemented on our Control center (register), probably all needed info are transmitted.<br />Your opinion is welcome. :-)</p></div>
    </div>
  </div>
  
  <div id="change-11182" class="journal has-notes">
    <div id="note-3">
    <h4><a href="/issues/1910#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/e4ba10895f26da81261d2e8202baf6de?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/177" class="user active">Cristian Mammoli</a> <a href="/projects/nethserver/activity?from=2014-05-30" title="05/30/2014 04:37 PM">about 7 years</a> ago</h4>

    <div class="wiki" id="journal-11182-notes"><p>IMHO the highest priority is to allow DKIM signing in amavisd. Many big providers are performing dkim checking and Spamassassin itself (on the receiving side) will significantly lower the spam score of correctly signed emails.</p>


	<p>Administrators could setup dmarc records for their domains as long as the emails are DKIM signed and the SPF record is correctly configured.</p>


	<p>A Wizard that suggests the correct DNS records would be nice but first you need to have all the pieces "ready" on the server side.</p></div>
    </div>
  </div>
  
  <div id="change-11184" class="journal has-notes">
    <div id="note-4">
    <h4><a href="/issues/1910#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2014-05-30" title="05/30/2014 05:58 PM">about 7 years</a> ago</h4>

    <div class="wiki" id="journal-11184-notes"><blockquote>

	<p>IMHO the highest priority is to allow DKIM signing in amavisd. Many big providers are performing dkim checking and Spamassassin itself (on the receiving side) will significantly lower the spam score of correctly signed emails.</p>


</blockquote>

	<p>Agreed. Following this howto (<a class="external" href="http://www.faqforge.com/linux/how-to-enable-dkim-email-signatures-in-amavisd-new-and-ispconfig-3/">http://www.faqforge.com/linux/how-to-enable-dkim-email-signatures-in-amavisd-new-and-ispconfig-3/</a>) I configured dkim successfully in a few minutes. I plan to proceed in two steps:<br />1. add support to amavisd in templates and db<br />2. add a user interface to enable dkim and show txt record to c&#38;p in dns</p>


	<p>Random notes:<br /><pre>
# grep dkim /etc/amavisd.conf 
$enable_dkim_verification = 1; # disable DKIM signatures verification
$enable_dkim_signing = 1; # disable DKIM signing code
dkim_key('nethesis.lan', 'def', '/var/db/dkim/neth.key.pem');
@dkim_signature_options_bysender_maps = (
</pre><br />Adding a dkim txt record to dnsmasq for testing:<br /><pre>
txt-record=def._domainkey.nethesis.lan.,v=DKIM1; p=MIGfMA0GCSqGSIb3DQEBAQUA...
</pre><br />The key should go into a backup, probably a better path to save keys would be in /var/lib/nethserver.</p></div>
    </div>
  </div>
  
  <div id="change-11243" class="journal has-notes">
    <div id="note-5">
    <h4><a href="/issues/1910#note-5" class="journal-link">#5</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2014-06-05" title="06/05/2014 03:33 PM">about 7 years</a> ago</h4>

    <div class="wiki" id="journal-11243-notes"><pre>
# amavisd genrsa /etc/pki/tls/private/nethesis-dkim.key.pem
# chgrp amavis /etc/pki/tls/private/nethesis-dkim.key.pem
# chmod g+r /etc/pki/tls/private/nethesis-dkim.key.pem
# cat /etc/e-smith/templates-custom/etc/amavisd.conf/95dkim 

$enable_dkim_verification = 1;
$enable_dkim_signing = 1;
dkim_key('nethesis.it', 'dkim', '/etc/pki/tls/private/nethesis-dkim.key.pem');
@dkim_signature_options_bysender_maps = (
\{ '.' =&gt; \{ ttl =&gt; 21*24*3600, c =&gt; 'relaxed/simple' \} \} );

dkim._domainkey.nethesis.it. in TXT
v=DKIM1; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDhnrXQYDUhfzxE1mg7U1JHWoPk8r0ZKl9OLxTApupnAIUfKJktAfVdSRUZhpqgOokH2X2fDGg5VRq7BYQ0nEDuWYqpOpMNb2neXT4KotrSib41kT3s0jSA23KL86/PjxXk0AuPoTyDQFZpcFbcn9wxYuvksQ+YMfOwZcqMem3v/wIDAQAB
</pre>

	<p>Edit: see <a href="/issues/1910#note-6" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Help DMARC setup (CLOSED)">#1910#note-6</a></p></div>
    </div>
  </div>
  
  <div id="change-12114" class="journal has-notes">
    <div id="note-6">
    <h4><a href="/issues/1910#note-6" class="journal-link">#6</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2014-09-08" title="09/08/2014 09:27 AM">almost 7 years</a> ago</h4>

    <div class="wiki" id="journal-12114-notes"><p>Filippo Carletti wrote:</p>


<blockquote>

	<p>[...]</p>


</blockquote>

	<p>Edit:<br />the private/public key pair PEM file must be readable by <code>amavis</code> group, otherwise <code>service amavisd reload</code> fails.</p>


	<p>Added the following commands to the <a href="/issues/1910#note-5">previous note</a>.<br /><pre>
chgrp amavis /etc/pki/tls/private/nethesis-dkim.key.pem
chmod g+r /etc/pki/tls/private/nethesis-dkim.key.pem
</pre></p>


	<p>See also <br /><a class="external" href="http://lists.amavis.org/pipermail/amavis-users/2013-March/002209.html">http://lists.amavis.org/pipermail/amavis-users/2013-March/002209.html</a></p></div>
    </div>
  </div>
  
  <div id="change-16068" class="journal has-notes">
    <div id="note-7">
    <h4><a href="/issues/1910#note-7" class="journal-link">#7</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/d1393faf88bfcbb0b41ce36307b6a143?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/8" class="user active">Filippo Carletti</a> <a href="/projects/nethserver/activity?from=2015-08-10" title="08/10/2015 09:36 AM">almost 6 years</a> ago</h4>

    <div class="wiki" id="journal-16068-notes"><p>DKIM key could/should be created at domain creation time.</p>


	<p>amavis dkim check could be enabled by default, but I'm not sure it will add protection against spam.</p>


	<p>opendkim publishes stats (<a class="external" href="http://www.opendkim.org/stats/report.html">http://www.opendkim.org/stats/report.html</a>), but I can't read them.</p></div>
    </div>
  </div>
  
  <div id="change-17625" class="journal has-notes has-details">
    <div id="note-8">
    <h4><a href="/issues/1910#note-8" class="journal-link">#8</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2016-08-26" title="08/26/2016 08:48 AM">almost 5 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Resolution</strong> set to <i>REJECTED</i></li>
    </ul>
    <div class="wiki" id="journal-17625-notes"><p>This feature will not be implemented in NS 6. If needed, please reopen it for NS 7.</p></div>
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>

<p class="other-formats">Also available in:  <span><a href="/issues/1910.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="/issues/1910.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>



<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright © 2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
