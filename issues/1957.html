<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Feature #1957: VPN: support IPsec/L2TP - NethServer 6 - NethServer.org</title>
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" name="csrf-token" />
<link rel='shortcut icon' href='/favicon.ico?1457596383' />
<link href="../stylesheets/jquery/jquery-ui-1.9.2.css%3F1403512057" media="all" rel="stylesheet" type="text/css" />
<link href="../stylesheets/application.css" media="all" rel="stylesheet" type="text/css" />

<script src="../javascripts/jquery-1.8.3-ui-1.9.2-ujs-2.0.3.js%3F1403512056" type="text/javascript"></script>
<script src="../javascripts/application.js%3F1403512056" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>
<script src="../themes/nethserver../javascripts/theme.js%3F1403512057" type="text/javascript"></script>
<link href="/plugin_assets/openid_fix../stylesheets/openid.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" />
<!-- page specific tags -->
    <link href="http://dev.nethserver.org/issues/1957.atom" rel="alternate" title="NethServer 6 - Feature #1957: VPN: support IPsec/L2TP" type="application/atom+xml" />
<script src="../javascripts/context_menu.js%3F1403512056" type="text/javascript"></script><link href="../stylesheets/context_menu.css%3F1403512057" media="screen" rel="stylesheet" type="text/css" /></head>
<body class="theme-Nethserver project-nethserver controller-issues action-show">
<div id="wrapper">
<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a href="/login" class="login">Sign in</a></li></ul>    </div>
    
    <ul><li><a href="/" class="home">Home</a></li>
<li><a href="/projects" class="projects">Projects</a></li>
<li><a href="http://www.redmine.org/guide" class="help">Help</a></li></ul></div>

<div id="header">
    <div id="quick-search">
        <form accept-charset="UTF-8" action="/projects/nethserver/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div>
        <input name="issues" type="hidden" value="1" />
        <label for='q'>
          <a href="/projects/nethserver/search" accesskey="4">Search</a>:
        </label>
        <input accesskey="f" class="small" id="q" name="q" size="20" type="text" />
</form>        
    </div>

    <h1>NethServer 6</h1>

    <div id="main-menu">
        <ul><li><a href="/projects/nethserver" class="overview">Overview</a></li>
<li><a href="/projects/nethserver/activity" class="activity">Activity</a></li>
<li><a href="/projects/nethserver/roadmap" class="roadmap">Roadmap</a></li>
<li><a href="/projects/nethserver/issues" class="issues selected">Issues</a></li>
<li><a href="/projects/nethserver/wiki" class="wiki">Wiki</a></li>
<li><a href="/projects/nethserver/repository" class="repository">Repository</a></li></ul>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/nethserver/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/nethserver/issues/report">Summary</a></li>

</ul>




<h3>Custom queries</h3>
<ul class="queries"><li><a href="/projects/nethserver/issues?query_id=60" class="query">6.6 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=64" class="query">6.7 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=65" class="query">6.8 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=66" class="query">6.9 (changelog)</a></li>
<li><a href="/projects/nethserver/issues?query_id=12" class="query">@future/closed</a></li>
<li><a href="/projects/nethserver/issues?query_id=55" class="query">KNOWN_BUGS</a></li>
<li><a href="/projects/nethserver/issues?query_id=15" class="query">Lost+Found</a></li>
<li><a href="/projects/nethserver/issues?query_id=24" class="query">NEEDINFO</a></li>
<li><a href="/projects/nethserver/issues?query_id=26" class="query">ON_DEV</a></li>
<li><a href="/projects/nethserver/issues?query_id=27" class="query">ON_QA</a></li>
<li><a href="/projects/nethserver/issues?query_id=44" class="query">TODO Tasks</a></li>
<li><a href="/projects/nethserver/issues?query_id=54" class="query selected">UPDATES</a></li>
<li><a href="/projects/nethserver/issues?query_id=67" class="query">v6.10 (current)</a></li></ul>





        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #1957</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=50&amp;default=wavatar" ssl="false" title="" />

<div class="subject">
<div><h3>VPN: support IPsec/L2TP</h3></div>
</div>
        <p class="author">
        Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-05-20" title="05/20/2013 10:03 AM">about 8 years</a> ago.
        Updated <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 04:10 PM">almost 8 years</a> ago.
        </p>

<table class="attributes">
<tr><th class="status">Status:</th><td class="status">CLOSED</td><th class="start-date">Start date:</th><td class="start-date">09/17/2013</td></tr><tr><th class="priority">Priority:</th><td class="priority">Normal</td><th class="due-date">Due date:</th><td class="due-date">09/20/2013</td></tr><tr><th class="assigned-to">Assignee:</th><td class="assigned-to">-</td><th class="progress">% Done:</th><td class="progress"><table class="progress progress-100" style="width: 80px;"><tr><td class="closed" style="width: 100%;"></td></tr></table><p class="percent">100%</p></td></tr><tr><th class="category">Category:</th><td class="category">nethserver-ipsec</td><th></th><td></td></tr><tr><th class="fixed-version">Target version:</th><td class="fixed-version"><a href="/versions/157">v6.4-beta2</a></td><th></th><td></td></tr>
<tr>
	<th class="cf_13">Resolution:</th><td class="cf_13"></td>
	<th class="cf_14">NEEDINFO:</th><td class="cf_14">No</td>
</tr>


</table>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>L2TP is the new standard for VPN.</p>


	<p>L2TP should be integrated with system users using PAM (may require radius).</p>


See:
	<ul>
	<li><a class="external" href="http://blog.earth-works.com/2013/02/22/how-to-set-up-openswan-l2tp-vpn-server-on-centos-6/">http://blog.earth-works.com/2013/02/22/how-to-set-up-openswan-l2tp-vpn-server-on-centos-6/</a></li>
		<li><a class="external" href="https://raymii.org/s/tutorials/IPSEC_L2TP_vpn_on_CentOS_-_Red_Hat_Enterprise_Linux_or_Scientific_-_Linux_6.html">https://raymii.org/s/tutorials/IPSEC_L2TP_vpn_on_CentOS_-_Red_Hat_Enterprise_Linux_or_Scientific_-_Linux_6.html</a></li>
	</ul>


	<p>See also:<br /><a class="external" href="http://bugs.centos.org/view.php?id=5832">http://bugs.centos.org/view.php?id=5832</a></p>
  </div>
</div>
<div class="attachments">
<p><a href="/attachments/download/201/shorewall-ipsec.patch" class="icon icon-attachment">shorewall-ipsec.patch</a>    <a href="/attachments/201/shorewall-ipsec.patch"><img alt="Magnifier" src="/images/magnifier.png?1403512056" /></a>
  
  <span class="size">(2.21 KB)</span>
    <span class="author">Giacomo Sanchietti, 08/09/2013 02:48 PM</span>
  </p>
</div>





<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form>
<table class="list issues">
  <tr class="issue hascontextmenu" id="relation-328">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="1763" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="/issues/1763" class="issue tracker-2 status-5 priority-4 priority-default closed">Feature #1763</a>: VPN
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">08/28/2013</td>
  <td class="due_date">09/16/2013</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-369">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2248" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="/issues/2248" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2248</a>: Store root server certificate in NSS database
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date">09/25/2013</td>
  <td class="due_date">09/25/2013</td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-381">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2281" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="/issues/2281" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2281</a>: Reuse firewall rules on custom zones
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
  <tr class="issue hascontextmenu" id="relation-383">
  <td class="checkbox"><input name="ids[]" type="checkbox" value="2294" /></td>
  <td class="subject">
    Related to
    
    NethServer 6 - 
    <a href="/issues/2294" class="issue tracker-6 status-5 priority-4 priority-default closed">Enhancement #2294</a>: IPSec: honor VPNClientAccess property
  </td>
  <td class="status">CLOSED</td>
  <td class="start_date"></td>
  <td class="due_date"></td>
  <td class="buttons"></td>
  </tr>
</table>
</form>

<form accept-charset="UTF-8" action="/issues/1957/relations" class="new_relation" data-remote="true" id="new-relation-form" method="post" style="display: none;"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="O9v8tr7jDWYApOdi0G+30QrigCY6Zlvwpp0a1SfpBeU=" /></div>


<p><select id="relation_relation_type" name="relation[relation_type]" onchange="setPredecessorFieldsVisibility();"><option value="relates" selected="selected">Related to</option>
<option value="duplicates">Duplicates</option>
<option value="duplicated">Duplicated by</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input id="relation_issue_to_id" name="relation[issue_to_id]" size="10" type="text" />
<span id="predecessor_fields" style="display:none;">
Delay: <input id="relation_delay" name="relation[delay]" size="3" type="text" /> days
</span>
<input name="commit" type="submit" value="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script type="text/javascript">
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?project_id=nethserver&scope=all')
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/7df481f776a799abc3b54dc86ad96ad0e377e70c" title="Revision 7df481f7">Revision 7df481f7</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-19" title="09/19/2013 02:20 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>First commit. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-lib/revisions/2f4e079585d8a5b1f5fe40ddb06a6207ee22d5e2" title="Revision 2f4e0795">Revision 2f4e0795</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-20" title="09/20/2013 09:23 AM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>templates-default: added template-begin-semicolon for config files with comments starting with ";", like smb.conf or xl2tpd.conf. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-vpn/revisions/85f4399ef60b16c6e27aa2daee823e712782c5d7" title="Revision 85f4399e">Revision 85f4399e</a><br />
        <span class="author">Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-09-30" title="09/30/2013 11:57 AM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>pki-vpn-gencert: create pkcs12 file. Refs <a href="/issues/1763" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN (CLOSED)">#1763</a> <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-firewall-base/revisions/25d473acd04c7cab2790166cb5af3d116d9a862d" title="Revision 25d473ac">Revision 25d473ac</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-30" title="09/30/2013 02:09 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>/etc/shorewall/tunnels template: expanded on *-save and *-update events. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-firewall-base/revisions/9c61b4d945fe91581b80273871636d55fe98f14c" title="Revision 9c61b4d9">Revision 9c61b4d9</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-30" title="09/30/2013 02:09 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>/etc/shorewall/policy (20levelHigh): always apply "high" policy. Restore the condition when other policies will be defined. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-firewall-base/revisions/6414bc72b70842a48a443fd5922408d48c5ba367" title="Revision 6414bc72">Revision 6414bc72</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-30" title="09/30/2013 02:09 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>/etc/shorewall/hosts template: expanded on *-save and *-update event. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-vpn/revisions/180c2589a64cd83876599fa51b42ff3f7d035e66" title="Revision 180c2589">Revision 180c2589</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-03" title="10/03/2013 01:01 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Create empty default vpn DB. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-shorewall/revisions/29edddbdb23959663200a0cddafabbce73cf945f" title="Revision 29edddbd">Revision 29edddbd</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-03" title="10/03/2013 02:37 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>*.spec.in: added ipset requirement to manage VPN dynamic zones. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-firewall-base/revisions/f46d0c9c8375ab71ea5f65e8a577d4077cc6c4db" title="Revision f46d0c9c">Revision f46d0c9c</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-03" title="10/03/2013 04:04 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>shorewall/interfaces template (20ppp): generic PPP interface declaration. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-firewall-base/revisions/9a08773ca0fbce41bad089854e481ed2f73df170" title="Revision 9a08773c">Revision 9a08773c</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-07" title="10/07/2013 10:20 AM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>ip-up.local, ip-down.local scripts: set "ipparam" option for pppd to invoke a custom pppd script. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/0a7173b76fab5c3e1b01ec0bdcbeff8770a0a8d4" title="Revision 0a7173b7">Revision 0a7173b7</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-08" title="10/08/2013 06:32 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Initial IPsec configuration and UI stub. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-dnsmasq/revisions/9b8206238c2523b16dd819f39cfb3dd2c2cd86b2" title="Revision 9b820623">Revision 9b820623</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-09" title="10/09/2013 03:52 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>/etc/ppp/options.xl2tpd template: use green IP as DNS address. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-dnsmasq/revisions/1c0ef001f56f197e612f2abd27c73f59ce984e6e" title="Revision 1c0ef001">Revision 1c0ef001</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-09" title="10/09/2013 04:36 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Accept DHCP from all interfaces. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>Removed interfaces parameter in /etc/dnsmasq.conf template (10base).<br />bootps UDP port 67 must now be closed by firewall rules on interfaces<br />that must not allow it.</p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/916e74bdff8b00d93ae12d5609f1f76d4ed13afa" title="Revision 916e74bd">Revision 916e74bd</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-10" title="10/10/2013 10:42 AM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Set secret files permissions for root only. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>/etc/ipsec.secrets RPM default permissions are 0600, to keep secret<br />passwords secure. Also NSS DB private RSA key password must be kept<br />secure in /etc/ipsec.d/nsspassword.</p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/10e6a240034660ebe42f666f36309aa489fca99f" title="Revision 10e6a240">Revision 10e6a240</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-10" title="10/10/2013 02:56 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>VPN IPsec UI module. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>This first version of the web UI module controls ipsec and xl2tpd<br />daemons execution, changes RoadWarriors subnet assignment and IPsec<br />authentication method (PSK or RSA). The nethserver-ipsec-save event<br />has been defined for these purposes.</p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-vpn/revisions/7a115920559d3ccde87c72817d67cad1fd454fd2" title="Revision 7a115920">Revision 7a115920</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-11" title="10/11/2013 04:47 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Removed IPsec client configuration. Refs <a href="/issues/1763" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN (CLOSED)">#1763</a> <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>IPsec "client" configuration is still not supported: we accept L2TP<br />roadwarriors only.</p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/c86a757d990308b77625ae23fa22edcd6dfa60d7" title="Revision c86a757d">Revision c86a757d</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-11" title="10/11/2013 04:54 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Changed IPsec UI module labels. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/99cf0c751ce4836e6d98dd6a7c3b4baf65d559c1" title="Revision 99cf0c75">Revision 99cf0c75</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 10:04 AM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>use Nethgui\System\PlatformInterface as Validate, instead of "NethPlatform" class. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/0e496e2f3e467bdbaf2c2503c6daad3aa9357c70" title="Revision 0e496e2f">Revision 0e496e2f</a><br />
        <span class="author">Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 12:20 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>createlinks: excute firewall-adjust on nethserver-ipsec-save and nethserver-ipsec-update events. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/68b1c8da557e029569f853010ca51ee40ff040af" title="Revision 68b1c8da">Revision 68b1c8da</a><br />
        <span class="author">Added by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 12:21 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>ipsec.conf template: change 'leftid' option when rsa authentication is enabled. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>
    </div>
    </div>
    <div class="changeset odd">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/f21eda9e3e3336f88d219c7a769d33705083db37" title="Revision f21eda9e">Revision f21eda9e</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-21" title="10/21/2013 06:10 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Removed firewall-adjust action from update event. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>Update events are designed to be invoked by nethserver yum plugin<br />after the RPM transaction.  The firewall-adjust action is invoked<br />once, after all update events have been executed.</p>
    </div>
    </div>
    <div class="changeset even">
    <p><a href="/projects/nethserver/repository/nethserver-ipsec/revisions/4b989f551ac1e54e0330a8d953fdb0c8cac6f574" title="Revision 4b989f55">Revision 4b989f55</a><br />
        <span class="author">Added by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 12:52 PM">almost 8 years</a> ago</span></p>
    <div class="wiki">
        <p>Expand /etc/ppp/options.xl2tpd on nethserver-samba-* events. Refs <a href="/issues/1957" class="issue tracker-2 status-5 priority-4 priority-default closed" title="VPN: support IPsec/L2TP (CLOSED)">#1957</a></p>


	<p>/etc/ppp/options.xl2tpd must be re-expanded if ntlm_auth binary<br />becomes available.  Also removed pppd settings from xl2tpd.conf.</p>
    </div>
    </div>

</div>

<div id="history">
<h3>History</h3>
  <div id="change-6307" class="journal has-notes">
    <div id="note-1">
    <h4><a href="/issues/1957#note-1" class="journal-link">#1</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-06-26" title="06/26/2013 09:55 AM">about 8 years</a> ago</h4>

    <div class="wiki" id="journal-6307-notes"><p>See also:<br /><a class="external" href="http://wiki.nikoforge.org/L2TP/IPSec_VPN_Setup_on_Centos_6_(64-bit)_for_use_with_Android_ICS_and_iOS_5_Clients">http://wiki.nikoforge.org/L2TP/IPSec_VPN_Setup_on_Centos_6_(64-bit)_for_use_with_Android_ICS_and_iOS_5_Clients</a></p></div>
    </div>
  </div>
  
  <div id="change-6947" class="journal has-notes has-details">
    <div id="note-2">
    <h4><a href="/issues/1957#note-2" class="journal-link">#2</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-08-09" title="08/09/2013 02:48 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/download/201/shorewall-ipsec.patch">shorewall-ipsec.patch</a><a href="/attachments/201/shorewall-ipsec.patch"><img alt="Magnifier" src="/images/magnifier.png?1403512056" /></a> added</li>
       <li><strong>Status</strong> changed from <i>NEW</i> to <i>TRIAGED</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>20</i></li>
    </ul>
    <div class="wiki" id="journal-6947-notes"><p>Tested with StrongSwan (not working) and OpenSwan (partially working).</p>


	<p>I was able to connect iOS, Android and Windows XP clients using the green interface.<br />No luck to make it work in a server and gateway configuration. Error was:<br /><pre>
"L2TP-PSK-NAT"[3] 88.52.179.11 #3: next payload type of ISAKMP Identification Payload has an unknown value: 195
"L2TP-PSK-NAT"[3] 88.52.179.11 #3: probable authentication failure (mismatch of preshared secrets?): malformed payload in packet
| payload malformed after IV
|   ae 2e 8e 03  23 fd 55 1c  7f a8 07 a0  29 a8 d8 13
|   26 bf fa ae
"L2TP-PSK-NAT"[3] 88.52.179.11 #3: sending notification PAYLOAD_MALFORMED to 88.52.179.11:4500
</pre><br />No errors found in PKS configuration.</p>


	<p>Below the configuration following this tutorial: <a class="external" href="https://help.ubuntu.com/community/L2TPServer">https://help.ubuntu.com/community/L2TPServer</a><br />Configuration uses PSK and password saved in clear-text as chap secrets.</p>


	<a name="IPSEC-configuration"></a>
<h3 >IPSEC configuration<a href="#IPSEC-configuration" class="wiki-anchor">&para;</a></h3>


	<p>Package installation:<br /><pre>
yum localinstall http://ftp.uni-koeln.de/mirrors/fedora/epel/6/i386/epel-release-6-8.noarch.rpm 
yum --enablerepo=epel install openswan xl2tpd
</pre></p>


	<p>ipsec.conf (replace X.X.X.X with server IP address):<br /><pre>
version 2.0     # conforms to second version of ipsec.conf specification
config setup
    nat_traversal=yes
    virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!10.152.2.0/24
    oe=off
    protostack=netkey
    plutostderrlog=/var/log/ipsec.log

conn L2TP-PSK-NAT
    rightsubnet=vhost:%priv
    also=L2TP-PSK-noNAT

conn L2TP-PSK-noNAT
    authby=secret
    pfs=no
    auto=add
    keyingtries=3
    rekey=no
    # Apple iOS doesn't send delete notify so we need dead peer detection
    # to detect vanishing clients
    dpddelay=30
    dpdtimeout=120
    dpdaction=clear
    # Set ikelifetime and keylife to same defaults windows has
    ikelifetime=8h
    keylife=1h
    type=transport
    # Replace IP address with your local IP (private, behind NAT IP is okay as well)
    left=X.X.X.X
    # For updated Windows 2000/XP clients,
    # to support old clients as well, use leftprotoport=17/%any
    leftprotoport=17/%any
    right=%any
    rightprotoport=17/%any
    #force all to be nat'ed. because of iOS
    forceencaps=yes
</pre></p>


	<p>/etc/xl2tpd/xl2tpd.conf:<br /><pre>
[global]
ipsec saref = no
; debug tunnel = yes

[lns default]
ip range = 10.152.2.2-10.152.2.254
local ip = 10.152.2.1
; leave chap unspecified for maximum compatibility with windows, iOS, etc
; require chap = yes
refuse pap = yes
require authentication = yes
ppp debug = yes
pppoptfile = /etc/ppp/options.xl2tpd
length bit = yes
</pre></p>


	<p>/etc/ppp/options.xl2tpd:<br /><pre>
refuse-mschap-v2
refuse-mschap
ms-dns 8.8.8.8
ms-dns 8.8.4.4
asyncmap 0
auth
crtscts
idle 1800
mtu 1200
mru 1200
lock
hide-password
local
debug
name l2tpd
proxyarp
lcp-echo-interval 30
lcp-echo-failure 4
</pre></p>


	<p>/etc/ipsec.d/ipsec.secrets (replace X.X.X.X with server IP address):<br /><pre>
X.X.X.X   %any:  PSK "nethesis" 
</pre></p>


	<p>/etc/ppp/chap-secrets:<br /><pre>
test l2tpd nethesis *
test * nethesis *
</pre></p>


	<p>/etc/xl2tpd/l2tp-secrets:<br /><pre>
*    *    nethesis
</pre></p>


	<p>Add to sysctl and reboot (or activate using echo):<br /><pre>
# for ipsec, configure some additional settings
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.default.send_redirects = 0
</pre></p>


	<p>Firewall configuration:<br /><pre>
config set xl2tpd service status enabled access public UDPPort 1701
config set pluto service status enabled access public UDPPorts 500,4500
signal-event firewall-adjust
</pre><br />A partial Shorewall configuration is in attachment.<br />More information on Shorewall configuration: <a class="external" href="http://www.shorewall.net/IPSEC-2.6.html">http://www.shorewall.net/IPSEC-2.6.html</a></p>


	<p>Start services:<br /><pre>
service ipsec start
service xl2tpd start
</pre></p>


Logs:
	<ul>
	<li>/var/log/ipsec.log </li>
		<li>/var/log/messages (for xl2tpd)</li>
	</ul>


	<p>Windows XP/7 configuration (Windows Registry modification required):<br /><a class="external" href="http://support.microsoft.com/kb/926179/en-us">http://support.microsoft.com/kb/926179/en-us</a></p>


	<p>Command for checking IPSEC status:<br /><pre>
ip -s xfrm state
ip -s xfrm policy
</pre></p></div>
    </div>
  </div>
  
  <div id="change-7146" class="journal has-details">
    <div id="note-3">
    <h4><a href="/issues/1957#note-3" class="journal-link">#3</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-08-29" title="08/29/2013 12:29 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Parent task</strong> deleted (<del><i>#1763</i></del>)</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-7485" class="journal has-details">
    <div id="note-4">
    <h4><a href="/issues/1957#note-4" class="journal-link">#4</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-17" title="09/17/2013 11:04 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Due date</strong> set to <i>09/20/2013</i></li>
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>Assignee</strong> set to <i>Davide Principi</i></li>
       <li><strong>Start date</strong> set to <i>09/17/2013</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
       <li><strong>Estimated time</strong> set to <i>24.00</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-7592" class="journal has-notes">
    <div id="note-6">
    <h4><a href="/issues/1957#note-6" class="journal-link">#6</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-24" title="09/24/2013 06:54 PM">almost 8 years</a> ago</h4>

    <div class="wiki" id="journal-7592-notes"><p>Radius service is not required if we use the <code>pppd</code> <code>winbind</code> plugin for L2TP authentications and RSA certificates for simple net2net tunnels.</p>


	<p>See <a href="/issues/1769#note-3" class="issue tracker-2 status-5 priority-4 priority-default closed" title="Radius server (CLOSED)">#1769#note-3</a></p></div>
    </div>
  </div>
  
  <div id="change-7593" class="journal has-details">
    <div id="note-7">
    <h4><a href="/issues/1957#note-7" class="journal-link">#7</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-09-25" title="09/25/2013 09:10 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Subject</strong> changed from <i>VPN: support L2TP</i> to <i>VPN: support IPsec/L2TP</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-7843" class="journal has-notes has-details">
    <div id="note-8">
    <h4><a href="/issues/1957#note-8" class="journal-link">#8</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-10" title="10/10/2013 10:53 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Davide Principi</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    <div class="wiki" id="journal-7843-notes"><strong>Release notes</strong><br />This L2TP prototype works but some issues are not completely solved:
	<ol>
	<li><code>MS-CHAP(v2)</code> authentication is available <strong>only if</strong> <code>ntlm_auth</code> binary is detected when <code>/etc/ppp/options.xl2tpd</code> is expanded.  This means that <a href="/projects/nethserver/wiki/Nethserver-samba" class="wiki-page new">nethserver-samba</a> must be installed to authenticate system users.<br />  If this is not acceptable, don't install <code>ntlm_auth</code> and define CHAP users in <code>/etc/ppp/chap-secrets</code>.</li>
		<li><del><strong>All system users can connect</strong>. We can configure <code>ntlm_auth</code> to check for a specific group membership before grant access.</del> Fixed in <a href="/issues/2294" class="issue tracker-6 status-5 priority-4 priority-default closed" title="IPSec: honor VPNClientAccess property (CLOSED)">#2294</a></li>
		<li><strong>Firewall policy</strong> for connections between <code>lvpn</code> and <code>fw</code> zone is <strong>ACCEPT</strong> without any other rules. Everything is open. This issue must be solved after <a href="/issues/2281" class="issue tracker-6 status-5 priority-4 priority-default closed" title="Reuse firewall rules on custom zones (CLOSED)">#2281</a>.</li>
	</ol>


	<p>Net2net functionality is partially implemented.</p>


	<p><del>No UI interface is provided at this moment.</del></p>


	<p>Most log informations from ipsec (pluto) daemon are directed to <code>/var/log/ipsec.log</code>. <code>xl2tpd</code> and <code>pppd</code> daemons messages are in <code>/var/log/messages</code>, together with <code>pluto</code> startup/shutdown messages.</p>


<strong>Requires</strong>
	<ul>
	<li>nethserver-base-1.4.1-10.0git148d5133.ns6.noarch</li>
		<li>nethserver-lib-1.3.1-1.0git2f4e0795.ns6.noarch</li>
		<li>nethserver-vpn          gitd5f5fd8.ns6</li>
	</ul>


<strong>Test case 1</strong><br />Check L2TP with PSK.
	<ol>
	<li>Install <a href="/projects/nethserver/wiki/Nethserver-samba" class="wiki-page new">nethserver-samba</a> and <a href="/projects/nethserver/wiki/Nethserver-ipsec" class="wiki-page new">nethserver-ipsec</a></li>
		<li>Set PSK authentication: <pre>
   # config setprop ipsec status enabled KeyType psk KeyPskSecret s3cret
   # signal-event nethserver-ipsec-save
</pre></li>
		<li>Create a user account, <code>user01</code>, set a password <code>xxxx</code></li>
		<li>Configure your L2TP client (I've tested WinXP2/Win7), setting PSK, enabling MS-CHAP</li>
		<li>Connect providing <code>user01</code> credentials</li>
		<li>Check green network reachability</li>
	</ol>


<strong>Test case 2</strong><br />Check L2TP with RSA. As case 1, install packages, then
	<ol>
	<li>Set RSA authentication: <pre>
   # config setprop ipsec status enabled KeyType rsa
   # signal-event nethserver-ipsec-save
</pre> </li>
		<li>Download <code>.p12</code> user certificate and CA public key <code>ca.crt</code> from VPN/Accounts UI module</li>
		<li>Install the certificates in your client. For WinXP I've followed <a href="http://kb.juniper.net/kb/documents/public/VPN/ScreenOS_Windows_L2TP_IPSec.pdf" class="external">this guide</a> (pdf) from <a class="external" href="http://kb.juniper.net">http://kb.juniper.net</a>.</li>
		<li>Connect providing <code>user01</code> credentials</li>
		<li>Check green network reachability</li>
	</ol></div>
    </div>
  </div>
  
  <div id="change-7845" class="journal has-notes has-details">
    <div id="note-9">
    <h4><a href="/issues/1957#note-9" class="journal-link">#9</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-10" title="10/10/2013 03:45 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-7845-notes"><p>Added UI module implementation.</p>


	<p>In nethserver-testing:<br />nethserver-ipsec-0.0.4-1.ns6.noarch.rpm<br />nethserver-lib-1.3.1-1.0git2f4e0795.ns6.noarch.rpm<br />nethserver-shorewall-1.0.1-3.0gitaa80bbaf.ns6.noarch</p></div>
    </div>
  </div>
  
  <div id="change-7894" class="journal has-notes">
    <div id="note-10">
    <h4><a href="/issues/1957#note-10" class="journal-link">#10</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-11" title="10/11/2013 05:00 PM">almost 8 years</a> ago</h4>

    <div class="wiki" id="journal-7894-notes"><p>In nethserver-testing:<br />nethserver-vpn-1.0.0-25.0git7a115920.ns6.noarch<br />nethserver-ipsec-0.0.5-1.ns6.noarch<br />nethserver-firewall-base-1.0.5-7.0git9a08773c.ns6.noarch.rpm</p></div>
    </div>
  </div>
  
  <div id="change-7930" class="journal has-details">
    <div id="note-11">
    <h4><a href="/issues/1957#note-11" class="journal-link">#11</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-15" title="10/15/2013 10:09 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Giacomo Sanchietti</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-7961" class="journal has-notes has-details">
    <div id="note-12">
    <h4><a href="/issues/1957#note-12" class="journal-link">#12</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 11:51 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>TRIAGED</i></li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>20</i></li>
    </ul>
    <div class="wiki" id="journal-7961-notes"><p>Tested using samba as domain controller.</p>


	<p><strong>Test case 1: FAILED</strong></p>


	<p>Firewall rules are not applied by nethserver-ipsec-update and nethserver-ipsec-save events.<br />After reloading firewall rules, IPSec tunnel and L2TP authentication work correctly.</p>


	<p>Tested with Android client, release: 4.2.2 (CyanogenMod)</p>


	<p><strong>Test case 2: FAILED</strong></p>


	<p>IPSec daemon is not configured correctly to allow RSA authentication.</p>


	<p>Changes needed to <code>/etc/ipsec.conf</code>:</p>


<pre>
--- /etc/ipsec.conf    2013-10-16 09:49:51.593349777 +0000
+++ /etc/ipsec.conf.ok    2013-10-16 09:49:49.246435683 +0000
@@ -39,7 +39,7 @@
 conn %default
     authby=rsasig
     leftcert=fw.test.loc
-    leftid=@fw.test.loc
+    leftid=%fromcert
     leftrsasigkey=%cert
     type=tunnel

</pre>

	<p>Tested with Android client, release: 4.2.2 (CyanogenMod)</p>


	<p>See also <a href="/issues/2294" class="issue tracker-6 status-5 priority-4 priority-default closed" title="IPSec: honor VPNClientAccess property (CLOSED)">#2294</a></p></div>
    </div>
  </div>
  
  <div id="change-7962" class="journal has-details">
    <div id="note-13">
    <h4><a href="/issues/1957#note-13" class="journal-link">#13</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 12:10 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>ON_DEV</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-7963" class="journal has-notes has-details">
    <div id="note-14">
    <h4><a href="/issues/1957#note-14" class="journal-link">#14</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 12:31 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_DEV</i> to <i>MODIFIED</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>60</i></li>
    </ul>
    <div class="wiki" id="journal-7963-notes"><p>Updated /etc/openvpn.conf template and added firewall-adjust action to nethserver-ipsec-update and nethserver-ipsec-save events.</p></div>
    </div>
  </div>
  
  <div id="change-7964" class="journal has-notes has-details">
    <div id="note-15">
    <h4><a href="/issues/1957#note-15" class="journal-link">#15</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/557f8126150c57751ffc7d17a9f01e11?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/5" class="user active">Giacomo Sanchietti</a> <a href="/projects/nethserver/activity?from=2013-10-16" title="10/16/2013 12:31 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Giacomo Sanchietti</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-7964-notes">Package in nethserver-testing:
	<ul>
	<li>nethserver-ipsec-0.0.5-2.0git68b1c8da.ns6.noarch.rpm</li>
	</ul>


Package in nethserver-updates:
	<ul>
	<li>nethserver-lib-1.3.2-1.ns6.noarch.rpm</li>
	</ul>


	<p>Repeat previous test cases.</p></div>
    </div>
  </div>
  
  <div id="change-8022" class="journal has-details">
    <div id="note-16">
    <h4><a href="/issues/1957#note-16" class="journal-link">#16</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-17" title="10/17/2013 10:09 AM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Davide Principi</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-8076" class="journal has-details">
    <div id="note-17">
    <h4><a href="/issues/1957#note-17" class="journal-link">#17</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 12:59 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>TRIAGED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Davide Principi</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>20</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-8077" class="journal has-details">
    <div id="note-18">
    <h4><a href="/issues/1957#note-18" class="journal-link">#18</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 12:59 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>TRIAGED</i> to <i>MODIFIED</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>60</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-8078" class="journal has-notes has-details">
    <div id="note-19">
    <h4><a href="/issues/1957#note-19" class="journal-link">#19</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 01:00 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>MODIFIED</i> to <i>ON_QA</i></li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div class="wiki" id="journal-8078-notes"><p>In nethserver-testing:<br />nethserver-ipsec-0.0.7-1.ns6.noarch.rpm<br />nethserver-dnsmasq-1.0.5-4.0git1c0ef001.ns6.noarch.rpm</p></div>
    </div>
  </div>
  
  <div id="change-8079" class="journal has-details">
    <div id="note-20">
    <h4><a href="/issues/1957#note-20" class="journal-link">#20</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 01:04 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Davide Principi</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-8094" class="journal has-notes has-details">
    <div id="note-21">
    <h4><a href="/issues/1957#note-21" class="journal-link">#21</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 04:06 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>ON_QA</i> to <i>VERIFIED</i></li>
       <li><strong>Assignee</strong> deleted (<del><i>Davide Principi</i></del>)</li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>90</i></li>
    </ul>
    <div class="wiki" id="journal-8094-notes"><p><strong>VERIFIED</strong></p></div>
    </div>
  </div>
  
  <div id="change-8095" class="journal has-notes has-details">
    <div id="note-22">
    <h4><a href="/issues/1957#note-22" class="journal-link">#22</a>
    <img alt="" class="gravatar" default="wavatar" rating="PG" src="http://www.gravatar.com/avatar/ecb4e27446848579607dfdf7e161f7ef?rating=PG&amp;size=24&amp;default=wavatar" ssl="false" title="" />
    Updated by <a href="/users/9" class="user active">Davide Principi</a> <a href="/projects/nethserver/activity?from=2013-10-22" title="10/22/2013 04:10 PM">almost 8 years</a> ago</h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>VERIFIED</i> to <i>CLOSED</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    <div class="wiki" id="journal-8095-notes"><p>In nethserver-updates:<br />nethserver-ipsec-1.0.0-1.ns6.noarch.rpm<br />nethserver-dnsmasq-1.0.6-1.ns6.noarch.rpm<br />nethserver-shorewall-1.0.2-1.ns6.noarch.rpm<br />nethserver-firewall-base-1.0.6-1.ns6.noarch.rpm</p>


	<p>with dependencies:<br />xl2tpd-1.3.1-7.el6.x86_64.rpm (from EPEL)<br />openswan-2.6.32-20.el6_4.x86_64.rpm (from CentOS updates)</p></div>
    </div>
  </div>
  


</div>


<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>

<p class="other-formats">Also available in:  <span><a href="/issues/1957.atom" class="atom" rel="nofollow">Atom</a></span>
  <span><a href="/issues/1957.pdf" class="pdf" rel="nofollow">PDF</a></span>
</p>



<script type="text/javascript">
//<![CDATA[
contextMenuInit('/issues/context_menu')
//]]>
</script>

        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Copyright  2012-2021 nethserver.org
  </div></div>
</div>
</div>
</div>

</body>
</html>
